{% extends 'base.html' %}

{%- from 'components/error-summary/macro.html' import tnaErrorSummary -%}

{% block content %}
  <div class="tna-section">
    <div class="tna-container">
      <div class="tna-column tna-column--width-2-3 tna-column--width-5-6-medium tna-column--full-small tna-column--full-tiny">

        {% if form.errors %}
          {{ tnaErrorSummary(wtforms_errors(form, params={'headingLevel': 2, 'classes': 'tna-!--margin-bottom-m'})) }}
        {% endif %}

        {% set ns = namespace(field_count=0, file_fields_present=False) %}
        {% for field in form %}
          {% if field.name != 'csrf_token' %}
            {% set ns.field_count = ns.field_count + 1 %}
          {% endif %}
          {% if field.type in ['FileField', 'MultipleFileField'] %}
            {% set ns.file_fields_present = True %}
          {% endif %}
        {% endfor %}

        {%- if ns.field_count > 1 %}
        {%- if content.supertitle %}
        <hgroup class="tna-hgroup-xl">
          <p class="tna-hgroup__supertitle">{{ content.supertitle }}</p>
          <h1 class="tna-hgroup__title">{{ pageTitle }}</h1>
        </hgroup>
        {%- else %}
        <h1 class="tna-heading-xl">{{ pageTitle }}</h1>
        {%- endif %}
        {%- if content.description %}
        <p>{{ content.description }}</p>
        {%- endif %}
        {%- endif %}

        <form action="{{ page_path }}" method="post" enctype="{{ 'multipart/form-data' if handle_files and ns.file_fields_present else 'application/x-www-form-urlencoded' }}" class="{{ 'tna-!--margin-top-m' if ns.field_count > 1 else '' }}" novalidate>
          {% for field in form %}
            {% set params = {} %}
            {% if ns.field_count == 1 %}
              {% set params = {'headingSize': 'xl', 'headingLevel': 1} %}
            {% endif %}
            {{ field(params=params) }}
          {% endfor %}

          <div class="tna-button-group">
            <button class="tna-button" type="submit">Continue</button>
          </div>
        </form>

        <hr class="tna-!--margin-top-l">

        <h2 class="tna-heading-l">Session data</h2>
        <dl class="tna-dl">
          {% for page in session %}
          <dt>{{ page }}</dt>
          <dd>
            {{ session[page] }}
          </dd>
          {% endfor %}
          <dt>has_complete_path</dt>
          <dd>{{ has_complete_path }}</dd>
          <dt>earliest_incomplete_page</dt>
          <dd>{{ earliest_incomplete_page }}</dd>
        </dl>

        <h2 class="tna-heading-l">All pages</h2>
        <ul class="tna-ul">
          {% for page in pages %}
          <li>
            <a href="{{ page.get_page_path() }}">{{ page.name }}</a>
            {% if page.is_complete(temporary_validation=True) %}
              (Complete)
            {% else %}
              (Incomplete)
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        <p>
          <a href="{{ form_reset_path }}">Clear data and start again</a>
        </p>
      </div>
    </div>
  </div>
{% endblock %}
